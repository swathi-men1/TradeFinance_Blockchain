<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Corporate Dashboard | Trade Finance</title>

    <style>
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #f4f6f9;
      }

      header {
        background: #1a202c;
        color: white;
        padding: 15px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      header .left {
        display: flex;
        gap: 20px;
        align-items: center;
      }

      header h2 {
        margin: 0;
      }

      header a {
        color: #cbd5e0;
        text-decoration: none;
        font-weight: bold;
        cursor: pointer;
      }

      header a:hover {
        color: white;
      }

      .logout {
        background: #e53e3e;
        border: none;
        padding: 8px 14px;
        color: white;
        border-radius: 4px;
        cursor: pointer;
      }

      .container {
        padding: 30px;
        max-width: 1000px;
        margin: auto;
      }

      .card {
        background: white;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
        margin-bottom: 30px;
      }

      button {
        background: #3182ce;
        color: white;
        border: none;
        padding: 10px 16px;
        border-radius: 4px;
        cursor: pointer;
      }

      button:hover {
        background: #2b6cb0;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
      }

      th,
      td {
        padding: 12px;
        border-bottom: 1px solid #ddd;
        text-align: left;
      }

      th {
        background: #edf2f7;
      }

      /* ‚úÖ STATUS COLORS */
      .status-pending {
        color: orange;
        font-weight: bold;
      }

      .status-accepted {
        color: green;
        font-weight: bold;
      }

      .status-rejected {
        color: red;
        font-weight: bold;
      }

      footer {
        text-align: center;
        padding: 15px;
        font-size: 13px;
        color: #666;
      }
    </style>
  </head>

  <body>
    <!-- HEADER -->
    <header>
      <div class="left">
        <h2>Corporate Dashboard</h2>
        <a onclick="showUpload()">Upload Document</a>
        <a onclick="showMyDocs()">My Documents</a>
      </div>
      <button class="logout" onclick="logout()">Logout</button>
    </header>

    <div class="container">
      <!-- UPLOAD SECTION -->
      <div class="card" id="uploadSection">
        <h3>Upload Trade Finance Document</h3>
        <p>
          üìå Upload Invoice, Bill of Lading, Letter of Credit, or Purchase
          Order.<br />
          üìé <b>Note:</b> File is saved with the same name.
        </p>

        <input type="file" id="fileInput" />
        <br /><br />
        <button onclick="uploadDocument()">Upload Document</button>

        <p id="uploadStatus"></p>
      </div>

      <!-- MY DOCUMENTS SECTION -->
      <div class="card" id="myDocsSection" style="display: none">
        <h3>My Uploaded Documents</h3>

        <table>
          <thead>
            <tr>
              <th>Document Name</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="docsTable"></tbody>
        </table>
      </div>
    </div>

    <footer>¬© 2026 Trade Finance Demo | Corporate Portal</footer>

    <script>
      // üîê Protect page
      const token = localStorage.getItem("token");
      if (!token) {
        window.location.href = "../../login.html";
      }

      function logout() {
        localStorage.clear();
        window.location.href = "../../login.html";
      }

      function showUpload() {
        document.getElementById("uploadSection").style.display = "block";
        document.getElementById("myDocsSection").style.display = "none";
      }

      function showMyDocs() {
        document.getElementById("uploadSection").style.display = "none";
        document.getElementById("myDocsSection").style.display = "block";
        loadMyDocuments();
      }

      // üì§ Upload document
      async function uploadDocument() {
        const fileInput = document.getElementById("fileInput");
        const status = document.getElementById("uploadStatus");

        if (!fileInput.files.length) {
          status.style.color = "red";
          status.innerText = "Please select a file ‚ùå";
          return;
        }

        const formData = new FormData();
        formData.append("file", fileInput.files[0]);

        try {
          const res = await fetch("http://127.0.0.1:8000/upload-document", {
            method: "POST",
            headers: {
              Authorization: "Bearer " + token,
            },
            body: formData,
          });

          if (res.ok) {
            status.style.color = "green";
            status.innerText =
              "Uploaded successfully ‚úî Status: Pending (Waiting for bank verification)";
            fileInput.value = "";

            setTimeout(showMyDocs, 800);
          } else {
            status.style.color = "red";
            status.innerText = "Upload failed ‚ùå";
          }
        } catch (err) {
          status.style.color = "red";
          status.innerText = "Server error ‚ùå";
        }
      }

      // üìÑ Load documents with LIVE STATUS
      async function loadMyDocuments() {
        try {
          const res = await fetch("http://127.0.0.1:8000/my-documents", {
            headers: {
              Authorization: "Bearer " + token,
            },
          });

          if (!res.ok) {
            alert("Session expired ‚ùå");
            logout();
            return;
          }

          const docs = await res.json();
          const table = document.getElementById("docsTable");
          table.innerHTML = "";

          if (docs.length === 0) {
            table.innerHTML =
              "<tr><td colspan='2'>No documents uploaded yet</td></tr>";
            return;
          }

          docs.forEach((doc) => {
            let statusClass = "status-pending";

            if (doc.status === "ACCEPTED") statusClass = "status-accepted";
            if (doc.status === "REJECTED") statusClass = "status-rejected";

            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${doc.filename}</td>
              <td class="${statusClass}">${doc.status}</td>
            `;
            table.appendChild(row);
          });
        } catch (err) {
          alert("Failed to load documents ‚ùå");
        }
      }
    </script>
  </body>
</html>
