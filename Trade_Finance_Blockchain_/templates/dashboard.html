<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TradeChain Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#0b1220;
  --panel:#111a2e;
  --card:#0f1b33;
  --accent:#20c997;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --danger:#dc2626;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:Segoe UI,Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
}

/* ---------- LAYOUT ---------- */
.container{
  display:flex;
  height:100vh;
}

/* ---------- SIDEBAR ---------- */
.sidebar{
  width:240px;
  background:#0a1020;
  padding:20px;
}
.sidebar h2{
  color:var(--accent);
  margin-bottom:30px;
}
.sidebar a{
  display:block;
  color:var(--muted);
  text-decoration:none;
  padding:10px;
  border-radius:6px;
  margin-bottom:6px;
}
.sidebar a:hover,
.sidebar a.active{
  background:var(--card);
  color:var(--accent);
}

/* ---------- MAIN ---------- */
.main{
  flex:1;
  padding:20px;
  overflow:auto;
}

/* ---------- TOP BAR ---------- */
.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
}
.search{
  background:var(--card);
  border:none;
  padding:10px 14px;
  border-radius:8px;
  color:var(--text);
  width:300px;
}

/* ---------- USER DROPDOWN ---------- */
.user-dropdown{
  position:relative;
}
.user-btn{
  background:var(--panel);
  color:var(--text);
  border:1px solid #1f2a44;
  padding:8px 14px;
  border-radius:20px;
  font-size:13px;
  cursor:pointer;
}
.user-btn:hover{
  border-color:var(--accent);
}

.dropdown{
  display:none;
  position:absolute;
  right:0;
  top:42px;
  width:260px;
  background:var(--panel);
  border-radius:12px;
  box-shadow:0 15px 35px rgba(0,0,0,0.6);
  padding:16px;
  z-index:100;
}
.dropdown.active{
  display:block;
}

.profile-row{
  font-size:13px;
  margin-bottom:8px;
}
.profile-row span{
  color:var(--muted);
}

.logout{
  margin-top:12px;
  display:block;
  text-align:center;
  padding:8px;
  border-radius:10px;
  text-decoration:none;
  color:#fca5a5;
  border:1px solid var(--danger);
}
.logout:hover{
  background:var(--danger);
  color:white;
}

/* ---------- CARDS ---------- */
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:20px;
  margin-bottom:30px;
}
.card{
  background:var(--panel);
  padding:20px;
  border-radius:14px;
}
.card h4{
  color:var(--muted);
  font-size:14px;
}
.card .value{
  font-size:28px;
  margin-top:10px;
}

/* ---------- GRID ---------- */
.grid{
  display:grid;
  grid-template-columns:2fr;
  gap:20px;
}

/* ---------- LEDGER ---------- */
.ledger-item{
  background:var(--panel);
  padding:14px;
  border-radius:10px;
  margin-bottom:12px;
}
.ledger-item span{
  color:var(--muted);
  font-size:13px;
}
.user-icon{
  color:#ffffff;
  margin-right:6px;
}

</style>
</head>

<body>

<div class="container">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <h2>TradeChain</h2>
    <a class="active" href="/dashboard">Dashboard</a>
    <a href="/documents">Documents</a>
    <a href="/ledger">Ledger Explorer</a>
    <a href="/transactions">Transactions</a>
    <a href="/risk">Risk Scores</a>
    <a href="/analytics">Analytics</a>
  </aside>

  <!-- MAIN -->
  <main class="main">

    <!-- TOP BAR -->
    <div class="topbar">
      <input class="search" placeholder="Search documents, transactions...">

      <div class="user-dropdown">
       <button class="user-btn" onclick="toggleDropdown()">
  <span class="user-icon">ðŸ‘¤</span> {{ user_name | default("User") }} â–¾
</button>

        <div id="dropdown" class="dropdown">
          <div class="profile-row">
            <span>Name:</span> {{ user_name | default("N/A") }}
          </div>
          <div class="profile-row">
            <span>Email:</span> {{ user_email | default("N/A") }}
          </div>
          <div class="profile-row">
            <span>Role:</span> {{ user_role | default("N/A") }}
          </div>
          <div class="profile-row">
            <span>Organization:</span> {{ user_org | default("N/A") }}
          </div>

          <a class="logout" href="/auth/logout">Logout</a>
        </div>
      </div>
    </div>

    <!-- CARDS -->
    <div class="cards">
      <div class="card">
        <h4>Total Documents</h4>
        <div class="value">{{ total_documents }}</div>
      </div>
      <div class="card">
        <h4>Active Transactions</h4>
        <div class="value">{{ active_transactions }}</div>
      </div>
      <div class="card">
        <h4>Verified Today</h4>
        <div class="value">{{ verified_today }}</div>
      </div>
      <div class="card">
        <h4>Avg Risk Score</h4>
        <div class="value">{{ avg_risk_score }}</div>
      </div>
    </div>

    <!-- LEDGER -->
    <section>
      <h3>Recent Ledger Events</h3>

      {% if recent_ledger %}
        {% for entry in recent_ledger %}
        <div class="ledger-item">
          <strong>{{ entry.action }}</strong>
          <div>{{ entry.document_id }}</div>
          <span>{{ entry.actor }} â€¢ {{ entry.timestamp }}</span>
        </div>
        {% endfor %}
      {% else %}
        <p>No ledger activity found.</p>
      {% endif %}
    </section>

  </main>

</div>

<script>
function toggleDropdown(){
  document.getElementById("dropdown").classList.toggle("active");
}

document.addEventListener("click", function(e){
  const dropdown = document.getElementById("dropdown");
  const button = document.querySelector(".user-btn");

  if(!button.contains(e.target) && !dropdown.contains(e.target)){
    dropdown.classList.remove("active");
  }
});
</script>

</body>
</html>
